<!DOCTYPE html>
<html>
<head>
<title>Ajukan Barter - YokBarter</title>
<style>
/* ========== GLOBAL ========== */
body {
  font-family: 'Inter', 'Segoe UI', 'Roboto', sans-serif;
  background: #f3f5f9;
  margin: 0;
  color: #333;
  line-height: 1.6;
}

/* ========== LOGO / NAMA APLIKASI ========== */
.app-name {
  margin: 0;
  font-size: 28px;
  font-weight: 700;
  color: white;
  font-family: 'Arial', sans-serif;
  letter-spacing: -0.5px;
}

/* ========== HEADER ========== */
header {
  background: #0f2a56;
  color: white;
}

.header-top {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 20px 30px;
  background: #0f2a56;
  color: white;
  min-height: 80px;
}

.search-container {
  display: flex;
  flex: 1;
  max-width: 600px;
  margin: 0 20px;
}

.search-input {
  flex: 1;
  padding: 10px 15px;
  border: none;
  border-radius: 20px;
  font-size: 14px;
  outline: none;
}

.search-btn {
  padding: 10px 15px;
  background: transparent;
  border: none;
  color: #999;
  cursor: pointer;
  font-size: 16px;
}

.user-profile {
  width: 32px;
  height: 32px;
  background: #4a86e8;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: white;
  font-size: 14px;
}

.main-nav {
  background: #0f2a56;
  padding: 10px 0;
}

.main-nav ul {
  list-style: none;
  padding: 0;
  margin: 0;
  display: flex;
  justify-content: center;
  gap: 25px;
}

.main-nav li a {
  color: white;
  text-decoration: none;
  font-weight: 500;
  padding: 5px 0;
  position: relative;
  font-size: 14px;
}

.main-nav li a.active::after {
  content: '';
  position: absolute;
  bottom: -5px;
  left: 50%;
  transform: translateX(-50%);
  width: 20px;
  height: 2px;
  background: white;
}

.main-nav li a:hover {
  opacity: 0.8;
}

/* ========== DETAIL CONTAINER ========== */
.detail-container {
  max-width: 800px;
  margin: 30px auto;
  padding: 20px;
  background: white;
  border-radius: 12px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.1);
}

.detail-image {
  width: 100%;
  height: 400px;
  object-fit: cover;
  border-radius: 8px;
  margin-bottom: 20px;
}

.detail-info h2 {
  color: #0f2a56;
  margin-bottom: 10px;
}

.detail-info .price {
  font-size: 24px;
  color: #4a86e8;
  font-weight: bold;
  margin: 10px 0;
}

.form-barter {
  margin-top: 30px;
  padding-top: 20px;
  border-top: 1px solid #eee;
}

.form-barter input,
.form-barter textarea {
  width: 100%;
  padding: 12px;
  margin: 10px 0;
  border: 1px solid #ddd;
  border-radius: 6px;
  font-size: 14px;
}

.form-barter button {
  background: #4a86e8;
  color: white;
  border: none;
  padding: 12px 24px;
  border-radius: 6px;
  cursor: pointer;
  font-size: 16px;
  margin-right: 10px;
}

.back-btn {
  background: #6c757d;
}

/* Responsive */
@media (max-width: 767px) {
  .header-top {
    flex-direction: column;
    gap: 15px;
    padding: 15px;
  }
  
  .search-container {
    width: 100%;
    max-width: none;
    margin: 0;
  }
  
  .detail-image {
    height: 300px;
  }
}
</style>
</head>

<body>

<!-- PROTEKSI LOGIN YANG BENAR -->
<script>
if (localStorage.getItem("isLoggedIn") !== "true") {
  window.location.href = "login.html";
}

const currentUser = localStorage.getItem("currentUser");
if (currentUser) {
  document.getElementById("profil-initial").innerText = currentUser.charAt(0).toUpperCase();
}
</script>

<header>
  <div class="header-top">
    <div class="logo">
      <h1 class="app-name">YokBarter</h1>
    </div>
    
    <div class="search-container">
      <input type="text" placeholder="Cari barang..." class="search-input">
      <button class="search-btn">üîç</button>
    </div>
    
    <div class="user-profile">
      <span id="profil-initial">U</span>
    </div>
  </div>

  <nav class="main-nav">
    <ul>
      <li><a href="index.html">üè† Home</a></li>
      <li><a href="index.html#filter">üîç Jelajah</a></li>
      <li><a href="index.html#katalog">üîÑ Ajukan Barter</a></li>
      <li><a href="chat.html">üí¨ Chat</a></li>
      <li><a href="#" onclick="alert('Fitur Transaksi akan segera hadir!')">üì¶ Transaksi</a></li>
      <li><a href="#" onclick="alert('Fitur Saldo & Escrow akan segera hadir!')">üí∞ Saldo & Escrow</a></li>
    </ul>
  </nav>
</header>

<div class="detail-container">
  <img id="detail-image" class="detail-image" src="" alt="">
  
  <div class="detail-info">
    <h2 id="detail-nama"></h2>
    <p id="detail-harga" class="price"></p>
    <p id="detail-lokasi"><span>üìç</span> <span id="lokasi-text"></span></p>
    <p id="detail-deskripsi"></p>
    <div class="rating">
      <span>‚òÖ</span> <span id="detail-rating"></span>
    </div>
  </div>
  
  <div class="form-barter">
    <h3>Ajukan Penawaran Barter</h3>
    <input type="text" id="barang-ditawarkan" placeholder="Barang yang ingin kamu tawarkan untuk barter">
    <textarea id="pesan-barter" placeholder="Tulis pesan untuk pemilik barang ini..." rows="4"></textarea>
    <br>
    <button onclick="kirimPenawaran()">Kirim Penawaran Barter</button>
    <button class="back-btn" onclick="window.history.back()">Kembali ke Produk</button>
  </div>
</div>

<script>
// Ambil data dari URL parameter
const urlParams = new URLSearchParams(window.location.search);
const productId = urlParams.get('id');

// Data produk lengkap
const produkData = {
  'produk1': {
    nama: 'iPhone 12 Pro 128GB Pacific Blue',
    harga: 'Rp 8.000.000',
    lokasi: 'Jakarta Selatan',
    deskripsi: 'iPhone 12 Pro dalam kondisi sangat baik, masih garansi resmi Apple. Kelengkapan full set.',
    rating: '4.9',
    gambar: 'img/produk1.png'
  },
  'produk2': {
    nama: 'MacBook Pro M1 2020 13 inch',
    harga: 'Rp 15.000.000',
    lokasi: 'Bandung',
    deskripsi: 'MacBook Pro M1 chip, RAM 16GB, SSD 512GB. Masih mulus dan performa sangat cepat.',
    rating: '4.8',
    gambar: 'img/produk2.png'
  },
  'produk3': {
    nama: 'Sepeda Polygon Xtrada 6',
    harga: 'Rp 7.500.000',
    lokasi: 'Yogyakarta',
    deskripsi: 'Sepeda gunung Polygon ukuran L, masih baru dipakai 3 bulan. Kondisi prima.',
    rating: '4.7',
    gambar: 'img/produk3.png'
  },
  'produk4': {
    nama: 'PlayStation 5 + 2 Controller',
    harga: 'Rp 7.500.000',
    lokasi: 'Surabaya',
    deskripsi: 'PS5 disc edition + 2 controller original. Garansi masih berlaku.',
    rating: '4.9',
    gambar: 'img/produk4.png'
  },
  'produk5': {
    nama: 'Camera Sony A7III Body Only',
    harga: 'Rp 12.000.000',
    lokasi: 'Jakarta Pusat',
    deskripsi: 'Kamera mirrorless Sony A7III, shutter count masih rendah. Performa excellent.',
    rating: '4.6',
    gambar: 'img/produk5.png'
  },
  'produk6': {
    nama: 'Vespa Sprint 150 2019',
    harga: 'Rp 28.000.000',
    lokasi: 'Bandung',
    deskripsi: 'Vespa Sprint 150i tahun 2019, pajak hidup, kondisi mesin prima.',
    rating: '4.5',
    gambar: 'img/produk6.png'
  }
};

// Tampilkan data produk
if (productId && produkData[productId]) {
  const data = produkData[productId];
  document.getElementById('detail-nama').textContent = data.nama;
  document.getElementById('detail-harga').textContent = data.harga;
  document.getElementById('lokasi-text').textContent = data.lokasi;
  document.getElementById('detail-deskripsi').textContent = data.deskripsi;
  document.getElementById('detail-rating').textContent = data.rating;
  document.getElementById('detail-image').src = data.gambar;
} else {
  document.querySelector('.detail-container').innerHTML = '<h2>Produk tidak ditemukan</h2>';
}

// Kirim penawaran barter
function kirimPenawaran() {
  const barangDitawarkan = document.getElementById('barang-ditawarkan').value.trim();
  const pesanBarter = document.getElementById('pesan-barter').value.trim();
  
  if (!barangDitawarkan) {
    alert('Mohon isi barang yang ingin ditawarkan!');
    return;
  }
  
  if (!pesanBarter) {
    alert('Mohon tulis pesan untuk pemilik barang!');
    return;
  }
  
  // Simpan penawaran ke localStorage
  let penawaranBarter = JSON.parse(localStorage.getItem('penawaranBarter')) || [];
  
  const penawaranBaru = {
    id: Date.now(),
    produkId: productId,
    produkNama: produkData[productId].nama,
    barangDitawarkan: barangDitawarkan,
    pesan: pesanBarter,
    pengirim: localStorage.getItem("currentUser"),
    tanggal: new Date().toLocaleDateString('id-ID'),
    status: 'menunggu'
  };
  
  penawaranBarter.push(penawaranBaru);
  localStorage.setItem('penawaranBarter', JSON.stringify(penawaranBarter));
  
  // Simpan juga ke riwayat chat untuk produk ini
  const chatKey = `chat_${productId}`;
  let chatMessages = JSON.parse(localStorage.getItem(chatKey)) || [];
  
  chatMessages.push({
    sender: localStorage.getItem("currentUser"),
    text: `Saya menawarkan ${barangDitawarkan} untuk barter dengan ${produkData[productId].nama}. ${pesanBarter}`,
    timestamp: new Date().toLocaleTimeString()
  });
  
  localStorage.setItem(chatKey, JSON.stringify(chatMessages));
  
  alert('Penawaran barter berhasil dikirim!\nPenjual akan segera menghubungi Anda.');
  window.location.href = 'index.html';
}

// Logout
function logout() {
  localStorage.removeItem("isLoggedIn");
  localStorage.removeItem("currentUser");
  window.location.href = "login.html";
}
</script>

</body>
</html>